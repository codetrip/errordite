@using Errordite.Web.Extensions
@using Errordite.Web.Models.Organisation
@using Errordite.Web.Models.Users
@model EditUserViewModel

@{
    ViewBag.Title = "Edit Details";
}

@section contentHeader
{
    @if(ViewData.GetAppContext().CurrentUser.IsAdministrator())
    {
        <div id="pagetitle">
            <h1><i class="icon-arrow-right"></i>Users</h1>
        </div>
        @Html.Partial("Organisation/Tabs", OrganisationTab.Users)
    }
}

@using (Html.BeginForm("edit", "users", FormMethod.Post, new { id = "editUserForm" }))
{
    @Html.HiddenFor(m => m.CurrentUser)
    @Html.HiddenFor(m => m.UserId)
    
    <div class="base left-narrow">
        <h1>Edit @(Model.CurrentUser ? "Your Details" : "User")</h1>
        <div class="base-content">
            <ul class="errorditeform">
                <li>
                    @Html.LabelFor(m => m.FirstName, "First name")
                    @Html.TextBoxFor(m => m.FirstName)
                    @Html.ValidationMessageFor(m => m.FirstName)
                </li>
                <li>
                    @Html.LabelFor(m => m.LastName, "Last name")
                    @Html.TextBoxFor(m => m.LastName)
                    @Html.ValidationMessageFor(m => m.LastName)
                </li>
                <li>
                    @Html.LabelFor(m => m.Email, "Email")
                    @Html.TextBoxFor(m => m.Email)
                    @Html.ValidationMessageFor(m => m.Email)
                </li>
                <li>
                    <label>Group Membership</label>
                    <div class="custom-select border">
                        <ul>
                            @Html.EditorFor(m => m.Groups)
                        </ul>
                    </div>
                </li>
                <li>
                    @Html.LabelFor(m => m.TimezoneId, "Timezone")
                    @Html.DropDownListFor(m => m.TimezoneId, 
                        new[]
                        {
                            new SelectListItem
                            {
                                Selected = Model.TimezoneId == null,
                                Text = "Organisation Default",
                                Value = "",
                            }, 
                        }.Union(
                        TimeZoneInfo.GetSystemTimeZones().Select(t => new SelectListItem
                        {
                            Selected = Model.TimezoneId == t.Id, Value = t.Id, Text = t.DisplayName
                        })), new {@style = "width:330px;"})
                </li>
                <li class="cbox">
                    @Html.CheckBoxFor(m => m.IsAdministrator, (Model.CurrentUser && !Model.IsAdministrator ? new { disabled = "disabled" } : null)) @Html.LabelFor(m => m.IsAdministrator, "User is administrator?")
                    <i rel="tooltip" title="Only administrators can manage your organisation (managing users, groups and applications)." class="icon-info-sign"></i>
                </li>
            </ul>
        </div>
    </div>
    
    <div class="colfull buttons">
        <input type="submit" class="btn btn-success" value="Save Changes" />&nbsp;
        <a class="btn" href="@(Model.CurrentUser ? Url.Home(ViewData.GetAppContext()) : Url.Users())">Cancel</a>
    </div>
}