(function(){var a,b,d,e,c;window.Errordite={};RegExp.escape=function(f){return f.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")};a=(function(){function f(){}f.prototype.init=function(k,n){var g,h,l,m,o,i,j;$(".icon-info").tooltip();$(".tool-tip").tooltip();$(".dropdown-toggle").dropdown();g=$("div.paging");m=new b(n);m.init(k);h=$(".tabs");prettyPrint();for(i=0,j=h.length;i<j;i++){o=h[i];l=new e(o);$(o).data("controller",l);l.init()}Errordite.Spinner.enable();$("body").on("click","a.ajax",function(p){p.preventDefault();return $.ajax({url:this.href,type:$(this).hasClass("ajax-post")?"post":"get",success:function(q){return alert(q)},failure:function(){return"failed"}})});return $("body").on("click","[data-confirm]",function(){return confirm($(this).data("confirm"))})};f.prototype.datepicker=function(g){return g.find("div#daterange").daterangepicker({ranges:{Today:["today","today"],Yesterday:["yesterday","yesterday"],"Last 7 Days":[Date.today().add({days:-6}),"today"],"Last 30 Days":[Date.today().add({days:-29}),"today"],"This Month":[Date.today().moveToFirstDayOfMonth(),Date.today().moveToLastDayOfMonth()]}},function(i,h){$("#daterange span").html(i.toString("MMMM d, yyyy")+" - "+h.toString("MMMM d, yyyy"));return $("#daterange input").val(i.toString("u")+"|"+h.toString("u"))})};return f})();d=(function(){function f(){}f.prototype.disable=function(){return $(".spinner").ajaxStart(function(){return $(this).hide()}).ajaxStop(function(){return $(this).hide()})};f.prototype.enable=function(){return $(".spinner").ajaxStart(function(){return $(this).show()}).ajaxStop(function(){return $(this).hide()})};return f})();e=(function(){f.get=function(h){var g,i;g=$(h).closest(".tabs");if(!g.length){return null}i=g.data("controller");if(!(i!=null)){i=new f(g);i.init();g.data("controller",i)}return i};function f(g){this.node=$(g);this.parentNode=this.node.closest(":has(.tab)")}f.prototype.show=function(j){var g,h,i;if(this.parentNode.length===0){return}h=this.parentNode.find("div#"+j);if(!h.length){return false}i=this.node.find("li.active");i.removeClass("active");i.addClass("inactive");g=$("li:has(a[data-val="+j+"])");g.addClass("active");g.removeClass("inactive");this.parentNode.find("div.tab").addClass("hidden");h.removeClass("hidden");return g.find(".tablink").trigger("shown")};f.prototype.init=function(){var h,g=this;if(this.node.data("init")===true){return}this.node.data("init",true);if(this.parentNode.length===0){return}h=true;window.onpopstate=function(i){if(h){return h=false}else{return g.show(i.state||g.node.find("li a [data-val]:first").data("val"))}};return this.node.delegate("li a.tablink","click",function(j){var i,k;j.preventDefault();i=$(j.currentTarget);k=i.data("val");g.show(k);if(!(window.history.pushState!=null)){return}return window.history.pushState(k,"",i.attr("href"))})};return f})();b=(function(){function f(g){var h;h=this;this.currentPage=0;this.currentSize=0;this.changeFunc=g;this.pushState=false;this.rootNode=$("body");this.baseUrl=this.rootNode.find("input#page-link").val();this.contentNode=$("div.content");this.navigate=function(j,k){var i;i=j.closest(".ajax-container");if(i.length){return $.get(k,{},function(l){return i.html(l)})}else{return window.location.href=k}};this.getBaseUrl=function(i){return i.find("input#page-link").val()};this.init=function(){this.rootNode.delegate("input#pgno","blur",function(k){var i,j;k.preventDefault();j=$(this);i=j.closest(".paging");if(j.val()!==j.data("currentPage")){return h.navigate(i,decodeURI(h.getBaseUrl(i).replace("[PGNO]",j.val()).replace("[PGSZ]",i.find("select#pgsz").val())))}});this.rootNode.delegate("input#pgno","focus",function(j){var i;j.preventDefault();i=$(this);return i.data("currentPage",i.val())});this.rootNode.delegate("select#pgsz","change",function(k){var i,j,l,m;k.preventDefault();j=$(this);i=j.closest(".paging");l=(i.find("input#pgno").val()-1)*j.data("current")+1;m=Math.floor(l/j.val())+1;return h.navigate(i,decodeURI(h.getBaseUrl(i).replace("[PGNO]",m).replace("[PGSZ]",j.val())))});this.rootNode.delegate("div.pagination a","click",function(k){var i,j;k.preventDefault();j=$(this);i=j.closest(".paging");if(j.hasClass("active")||j.hasClass("disabled")){return}return h.navigate(i,j.attr("href"))});return this.contentNode.delegate("th.sort a","click",function(k){var i,j;k.preventDefault();j=$(this);i=j.closest(".paging");return h.navigate(i,j.attr("href"))})}}return f})();window.Tabs=e;window.Paging=b;window.Initalisation=a;window.Errordite.Spinner=new d();jQuery(function(){var f;f=new a();return f.init(false)});jQuery(function(){var f,h,g;f=$("section#applications");if(f.length>0){g=null;f.delegate("a.delete-application","click",function(j){var i;i=$(this);g=new h(i.closest("tr"));g["delete"]();return j.preventDefault()});f.delegate("a.generate-error","click",function(j){var i;i=$(this);new h(i.closest("tr")).generateError();return j.preventDefault()});return h=(function(){function i(j){this.$appEl=j}i.prototype["delete"]=function(){if(window.confirm("Are you sure you want to delete this application, all associated errors will be deleted?")){return this.$appEl.find("form:has(.delete-application)").submit()}};i.prototype.generateError=function(){return this.$appEl.find("form:has(.generate-error)").submit()};return i})()}});jQuery(function(){var f;f=$("div#dashboard-errors");if(f.length>0){return f.delegate("select#ApplicationId","change",function(){var g;g=$(this);if(g.val()!==""){window.location=g.val()}return false})}});jQuery(function(){var f,g,h,i,j;f=$("div#errors, div#issue, div#errordite-errors, div#dashboard").first();if(f.length>0){j=[];f.delegate("div#results ul.nav li a","click",function(l){var k;k=$(this);k.error=new g(k);k.error.switchTab();return l.preventDefault()});f.delegate("td.error-rowstate","click",function(l){var k,m;k=$(this);m=new g(k);m.toggle();return l.preventDefault()});if($("div#issue").length>0){f.delegate(".new-rule-match, .rule-match","click",function(){var k;$(".last-selected").removeClass("last-selected");$(".remove-rule").hide();k=$(this);k.addClass("last-selected");return k.closest(".prop-val").parent().find(".remove-rule").show().unbind("click").bind("click",function(){Errordite.ruleManager.removeRule(k.data("ruleId"));return $(this).hide()}).attr("title","Click to remove Rule: '"+(k.attr("title"))+"'")});$("body").on("changedrule",function(n,p){var o,k,l,m;m=[];for(k=0,l=j.length;k<l;k++){o=j[k];m.push(o.visualiseRules())}return m});$("body").on("ruleadded",function(){var n,k,l,m;m=[];for(k=0,l=j.length;k<l;k++){n=j[k];m.push(n.visualiseRules())}return m})}if($("div#dashboard").length===0){i=new Initalisation();i.datepicker(f)}$("body").on("remove","tr.rule",function(){var k,l,q,r,m,n,o,p;l=$(this);q=l.data("counter");o=$("[data-rule-id="+q+"]");p=[];for(m=0,n=o.length;m<n;m++){r=o[m];k=$(r);if(k.hasClass("rule-match")){p.push(k.addClass("old-rule-match").removeClass("rule-match").attr("title","REMOVED: "+k.attr("title")))}else{p.push(k.replaceWith(k.text()))}}return p});h=(function(){function k(l){this.$propEl=l;this.propName=l.data("error-attr")}k.prototype.visualiseRules=function(){var n,o,p,q,r,s,t,u,l,m;if(!this.propName){return null}p=_.flatten((function(){var v,w,x,y;x=Errordite.ruleManager.rules;y=[];for(v=0,w=x.length;v<w;v++){t=x[v];if(t.prop===this.propName){y.push(this.getMatchInfos(t))}}return y}).call(this));p=_.sortBy(p,function(v){return -v.start});r=this.$propEl.find(".prop-val").text();u=r;q=null;for(l=0,m=p.length;l<m;l++){o=p[l];if(!(q!=null)||q.start>o.end){n=o.length}else{n=q.start-o.start}s=RegExp("^([\\S\\s]{"+o.start+"})([\\S\\s]{"+n+"})([\\S\\s]*)");u=u.replace(s,"$1<span data-rule-id='"+o.rule.counter+"' \nclass='"+(o.rule.status==="new"?"new-":"")+"rule-match' \ntitle='"+(o.rule.description())+"'>$2</span>$3");q=o}return this.$propEl.find(".prop-val").html(u)};k.prototype.getMatchInfos=function(o){var l,m,n;switch(o.op){case"Equals":n=RegExp("(^"+(RegExp.escape(o.val))+"$)","g");break;case"Contains":n=RegExp("("+(RegExp.escape(o.val))+")","g");break;case"StartsWith":n=RegExp("(^"+(RegExp.escape(o.val))+")","g");break;case"EndsWith":n=RegExp("("+(RegExp.escape(o.val))+"$)","g");break;case"RegexMatches":n=RegExp("("+o.val+")","g")}l=[];if(n){m=this.$propEl.find(".prop-val").text();m.replace(n,function(p,r,q){l.push({start:q,length:r.length,end:q+r.length,match:r,rule:o});return null})}return l};return k})();return g=(function(){function k(l){this.$errorEl=l;this.$detailsEl=this.$errorEl.closest("tr").next()}k.prototype.switchTab=function(){var l,m,n,o;l=this.$errorEl;m=l.closest("td.error-item");o=l.data("val");n=m.find("div#"+o);m.find("ul.nav li.ui-tabs-selected").removeClass("ui-tabs-selected");l.closest("li").addClass("ui-tabs-selected");n.siblings().addClass("hidden");return n.removeClass("hidden")};k.prototype.visualiseRules=function(){var p,l,m,n,o;n=(function(){var q,r,s,t;s=this.$detailsEl.find("[data-error-attr]");t=[];for(q=0,r=s.length;q<r;q++){p=s[q];t.push(new h($(p)))}return t}).call(this);o=[];for(l=0,m=n.length;l<m;l++){p=n[l];o.push(p.visualiseRules())}return o};k.prototype.toggle=function(){var l,m,n;n=this;m=this.$errorEl;l=this.$detailsEl;if(m.hasClass("expanded")){m.removeClass("expanded");m.addClass("collapsed")}else{m.removeClass("collapsed");m.addClass("expanded");if((Errordite.ruleManager!=null)&&!m.data("rules-visualised")){j.push(this);m.data("rules-visualised",true);l.find("[data-error-attr]").each(function(){var o,p,q,r,s,t,u;q=$(this);u=q.text();if((u.trim!=null)&&!u.trim()){return}p=$('<span class="rule-controls"/>').css({display:"inline"}).hide();o=$("<button/>").addClass("btn").addClass("btn-mini").addClass("make-rule").text("Create Rule");r=$("<button/>").addClass("btn").addClass("btn-mini").addClass("remove-rule").text("Remove Rule").hide();p.append(o,r);q.on("mouseenter",function(){return p.show()});q.on("mouseleave",function(){return p.hide()});s=$("<span/>").addClass("prop-val").text(u);q.html(s);q.append(p);t=function(){var v,w,x,y,z,A,B;y=new Errordite.Rule();y.prop=q.data("error-attr");if(!(window.getSelection!=null)){y.op="Equals";return y.val=u}else{A=window.getSelection();z=A.getRangeAt(0);w=q.find(".prop-val");B=document.createRange();B.selectNodeContents(w.contents()[0]);v=document.createRange();v.selectNodeContents(w.contents().last()[0]);x={start:z.compareBoundaryPoints(Range.START_TO_START,B),end:z.compareBoundaryPoints(Range.END_TO_END,v)};if(A.toString()===""||x.start<0||x.end>0){y.val=u;y.op="Equals"}else{y.val=z.toString();if(x.start===0){if(x.end===0){y.op="Equals"}else{y.op="StartsWith"}}else{if(x.end===0){y.op="EndsWith"}else{y.op="Contains"}}}return y}};o.on("mouseenter",function(){var v;v=t();return $(this).attr("title","Click to add Rule: '"+(v.description())+"'")});return o.on("click",function(){var v,w,x;x=t();w=Errordite.ruleManager.addRule(x.prop,x.op,x.val);v=new h(o.closest("[data-error-attr]"));return v.visualiseRules()})});this.visualiseRules()}}return l.toggle()};return k})()}});jQuery(function(){var f,h,g;f=$("section#groups");if(f.length>0){g=null;f.delegate("a.delete","click",function(){var i;i=$(this);this.group=new h(i.closest("form"));this.group["delete"]();return false});return h=(function(){function i(j){this.$form=j}i.prototype["delete"]=function(){if(window.confirm("Are you sure you want to delete this group?")){return this.$form.submit()}};return i})()}});jQuery(function(){var f,g,h,i,j;f=$("section#issue");if(f.length>0){j=function(){var k,l;k=$(":input[name=Reference]");l=k.val();$("#reference-link").empty();if(/^https?:\/\//.test(l)){return $("#reference-link").html($("<a>").attr("href",l).attr("target","_blank").text("link"))}};g=function(k){if(!k.data("loaded")){if(k.data("val")==="reports"){i()}else{if(k.data("val")==="errors"){h()}}return k.data("loaded",true)}};i=function(){return $.get("/issue/getreportdata?issueId="+f.find("#IssueId").val(),function(k){$.jqplot("hour-graph",[k.ByHour.y],{seriesDefaults:{renderer:$.jqplot.BarRenderer},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:k.ByHour.x}}});if((k.ByDate!=null)&&k.ByDate.x.length&&k.ByDate.y.length){return $.jqplot("date-graph",[_.zip(k.ByDate.x,k.ByDate.y)],{seriesDefaults:{renderer:$.jqplot.LineRenderer},axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickOptions:{formatString:"%a %#d %b %y"}},yaxis:{min:0}},highlighter:{show:true,sizeAdjust:7.5}})}else{return $("#date-graph-box").hide()}})};h=function(){var k,l;l="/issue/errors?"+$("#errorsForm").serialize();k=f.find("#error-criteria");return $.get(l,function(m){var n;k.html(m);n=new Initalisation();n.datepicker(f);return $("div.content").animate({scrollTop:0},"slow")})};g($("ul#issue-tabs li.active a.tablink"));j();f.delegate(":input[name=Reference]","change",j);f.delegate('input[type="button"].confirm',"click",function(){var k;k=$(this);if(confirm("Are you sure you want to delete all errors associated with this issue?")){return $.post("/issue/purge","issueId="+k.attr("data-val"),function(l){h();return $("span#instance-count").text("0")})}});f.delegate("form#errorsForm","submit",function(l){var k;l.preventDefault();k=$(this);return h()});f.delegate("select#Status","change",function(){var k;k=$(this);if(k.val()==="Ignorable"){return f.find("li.checkbox").removeClass("hidden")}else{return f.find("li.checkbox").addClass("hidden")}});if(f.find("select#Status").val()==="Ignorable"){f.find("li.checkbox").removeClass("hidden")}$("#issue-tabs .tablink").bind("shown",function(k){return g($(k.currentTarget))});return f.delegate(".sort a[data-pgst]","click",function(l){var k;l.preventDefault();k=$(this);$("#pgst").val(k.data("pgst"));$("#pgsd").val(k.data("pgsd"));h();return false})}});jQuery(function(){var f,g,h,i;g=$("section#issues");f=null;if(g.length>0){h=new Initalisation();h.datepicker(g);g.delegate("form#actionForm","submit",function(k){var j;k.preventDefault();j=$(this);return $.post(j.attr("action"),j.serialize(),function(l){return window.location.reload()}).error(function(l){if(f!=null){f.find("div.alert").removeClass("hidden");return f.find("div.alert h4").text("An error occurred, please close the modal window and try again.")}})});g.delegate("ul.dropdown-menu li input","click",function(j){return j.stopPropagation()});g.delegate("ul.dropdown-menu li a","click",function(j){j.preventDefault();return $(this).closest("ul").find("li :checkbox").prop("checked",true)});g.delegate("ul.dropdown-menu li","click",function(l){var j,k;k=$(this);j=k.closest("li").children("input");j.attr("checked",!j.attr("checked"));return false});g.delegate("ul#action-list ul.dropdown-menu li a","click",function(){var j,k;k=$(this);j=g.find("div#"+k.attr("data-val-modal"));if(j===null){return null}g.find('input[type="hidden"]#Action').val(j.attr("id"));j.find(".batch-issue-count").text($(":checkbox:checked[name=issueIds]").length);j.find(".batch-issue-plural").toggle($(":checkbox:checked[name=issueIds]").length>1);if(j.find(".batch-issue-status").length>0){j.find(".batch-issue-status").text(k.attr("data-val-status"));g.find('input[type="hidden"]#Status').val(k.attr("data-val-status").replace(" ",""))}f=j;return j.modal()});$("th :checkbox").on("click",function(){$(this).closest("table").find("td :checkbox").prop("checked",$(this).is(":checked"));return i()});i=function(){return $("ul#action-list").toggle(!!$(":checkbox:checked[name=issueIds]").length)};g.delegate(":checkbox[name=issueIds]","click",function(){return i()});return i()}});c=0;jQuery(function(){var f;if($("section#issue, section#addissue").length>0){f=$("body");Errordite.Rule=(function(){function g(h){this.$rule=h;if(this.$rule!=null){this.prop=h.find(".rule-prop").val();this.op=h.find(".rule-operator").val();this.val=h.find(".rule-val").val();this.status=h.hasClass("new-rule")||h.hasClass("changed-rule")?"new":"saved";this.counter=c++;h.data("rule",this);h.data("counter",this.counter)}}g.prototype.description=function(){return""+this.prop+" "+this.op+" "+('"'+this.val+'"')};g.prototype.update=function(){if(this.$rule!=null){this.prop=this.$rule.find(".rule-prop").val();this.op=this.$rule.find(".rule-operator").val();this.val=this.$rule.find(".rule-val").val();return this.status=this.$rule.hasClass("new-rule")||this.$rule.hasClass("changed-rule")?"new":"saved"}};return g})();Errordite.RuleManager=(function(){function g(){var h;this.counter=0;this.rules=(function(){var i,j,k,l;k=$("#rules-table tr.rule");l=[];for(i=0,j=k.length;i<j;i++){h=k[i];l.push(new Errordite.Rule($(h)))}return l})()}g.prototype.addRule=function(i,j,l){var h,k;if(this.rules.length>0){h=$("table#rules-table tr.rule:first").clone();h.insertAfter("table#rules-table tr.rule:last")}else{h=$("table#rules-table tr.rule:first");h.show()}h.addClass("new-rule");this.reindex();h.find(":input").val("");if(i!=null){h.find(".rule-prop").val(i)}if(j!=null){h.find(".rule-operator").val(j)}if(l!=null){h.find(".rule-val").val(l)}this.parseRulesForm();this.showRuleUpdatesPanel();k=new Errordite.Rule(h);this.rules.push(k);k.$rule.trigger("ruleadded");return k};g.prototype.removeRule=function(h){var i;if(isFinite(h)){i=_(this.rules).find(function(j){return j.counter===h});if(!(i!=null)){return false}h=i.$rule}this.parseRulesForm();this.rules=(function(){var j,k,l,m;l=this.rules;m=[];for(j=0,k=l.length;j<k;j++){i=l[j];if(h.data("rule")!==i){m.push(i)}}return m}).call(this);h.trigger("remove");if(this.rules.length>0){h.remove();this.showRuleUpdatesPanel()}else{h.hide();this.hideRuleUpdatesPanel()}return this.reindex()};g.prototype.parseRulesForm=function(){var h;h=$("form#rulesForm","form#addIssue");h.removeData("validator");h.removeData("unobtrusiveValidation");return $.validator.unobtrusive.parse(h)};g.prototype.reindex=function(){var h,i;h=0;i=function(j){return j.replace(/\.|\[|\]/g,"_")};return $("table#rules-table tbody tr").each(function(q,s){var j,r,t,u,k,l,m,n,o,p;j=$(s);o=j.find(":input");for(k=0,m=o.length;k<m;k++){r=o[k];if(!(/\[\d*\]/.test(r.name))){continue}t=r.name;r.name=r.name.replace(/(.*)\[\d*\]/,"$1["+h+"]");p=j.find("[data-valmsg-for='"+t+"']");for(l=0,n=p.length;l<n;l++){u=p[l];$(u).attr("data-valmsg-for",r.name)}r.id=i(r.name)}return h++})};g.prototype.showRuleUpdatesPanel=function(){return $("#rules-adjusted").show()};g.prototype.hideRuleUpdatesPanel=function(){return $("#rules-adjusted").hide()};return g})();Errordite.ruleManager=new Errordite.RuleManager();f.delegate("button#apply-rule-updates","click",function(h){var g;g=$("form#rulesForm");g.validate();if(g.valid()){$("#apply-rules-confirmation").modal()}return(e.get($("#issue-tabs"))).show("rules")});f.delegate("div#rules a.add","click",function(g){Errordite.ruleManager.addRule();return g.preventDefault()});f.delegate("div#rules a.delete","click",function(g){Errordite.ruleManager.removeRule($(this).closest("tr"));return g.preventDefault()});f.delegate("tr.rule :input","change",function(){var g;g=$(this).closest("tr.rule");g.data("rule").update();g.addClass("changed-rule");$("body").trigger("changedrule",g);return Errordite.ruleManager.showRuleUpdatesPanel()});if($("table#rules-table tbody tr").length===1){f.find("a.delete").hide();return f.find("span.divider").hide()}}});jQuery(function(){var f,h,g;f=$("section#users");if(f.length>0){g=null;f.delegate("a.delete","click",function(){var i;i=$(this);this.user=new h(i.closest("form"));this.user["delete"]();return false});return h=(function(){function i(j){this.$form=j}i.prototype["delete"]=function(){if(window.confirm("Are you sure you want to delete this user, any issues assigned to this user will be assigned to you!")){return this.$form.submit()}};return i})()}});jQuery(function(){var f;f=$("div#organisations");if(f.length>0){f.delegate("form#suspendForm","submit",function(h){var g;h.preventDefault();g=$(this);return $.post(g.attr("action"),g.serialize(),function(i){return window.location.reload()})});f.delegate("a.suspend","click",function(i){var g,h;i.preventDefault();h=$(this);g=f.find("div#suspend-modal");if(g===null){return null}g.find("input[type=hidden]").val(h.data("val"));return g.modal()});f.delegate("input[type=submit].activate","click",function(h){var g;g=$(this);if(confirm("are you sure you want to activate this organisation?")){return true}h.preventDefault();return false});return f.delegate("input[type=submit].delete","click",function(h){var g;g=$(this);if(confirm("are you sure you want to delete this organisation, all data will be permenantly deleted?")){return true}h.preventDefault();return false})}});window.Errordite={}}).call(this);